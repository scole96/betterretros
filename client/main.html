<head>  
  <title>Better Retros</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet"/>
  <link href="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.4.5/bootstrap-editable/css/bootstrap-editable.css" rel="stylesheet"/>
  <script src="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.4.5/bootstrap-editable/js/bootstrap-editable.min.js"></script>
</head>

<body>
  <div class="container-fluid">
    {{#if currentUser}}
      {{> header }}
      {{> main_body }}
    {{else}}
      <div class="pull-right">
        {{loginButtons align="right"}}
      </div>
      <img src="logo.png"/>

      <div class="text-center">
        <p><strong>Better Retros is a tool to help Agile Teams execute, report and follow-up on their retrospectives.</strong></p>
        <br/>
        <label>Interested?</label>
        {{>inviteRequest}}
      </div> 
    {{/if}} 
  </div>
</body>

<template name="header">
  <div class="row-fluid">
    <div class="span10 headerSelect">
      <img class="pull-left" src="logo.png" width="250" height="77"/>
      {{#if currentUser}}
        {{>selection}}
      {{else}}
        <p>You have to sign in to start</p>
      {{/if}}
    </div>
    <div class="pull-right">
      {{loginButtons align="right"}}
    </div>
  </div>
</template>

<template name="inviteRequest">
  {{>meteorMessages}}
  <form id="emailForm">
    <input id="email" type="text" class="input-xlarge" placeholder="your email address"/><br/>
    <input type="submit" class="btn btn-primary" value="Request an Invitation" />
  </form>
</template>

<template name="main_body">
  <div class="row-fluid">
    <div class="span10">
      {{>activityTab}}
      {{{main}}}
    </div>
    <div class="span2">
      <h4>Action Items</h4>
    </div>
  </div>
</template>

<template name="activityTab">
    <ul class="nav nav-tabs">
      {{#each activities}}
        <li><a class="activityLink" data-id="{{_id}}">{{name}}</a></li>
      {{/each}}
      <li><a class="newActivity"> + </li>
    </ul>
</template>

<template name="active_users">
  <span class="pull-right">
    {{#each getActiveUsers}}
      <span class="user-initals">{{profile.initials}}</span>
    {{/each}}
  </span>
</template>

<template name="team">
  {{#with current}}
    <ul class="nav pull-left">
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">
          {{name}}<b class="caret"></b>
        </a> 
        <ul class="dropdown-menu">
          {{#if userHasMultipleTeams}}
            <li class="usermenu-submenu">Teams:
              <ul class="unstyled submenu" style="padding-left:20px">
                {{#each usersTeams}}
                  <li>
                    <a class="teamRadio" data-teamId="{{_id}}" data-teamName="{{name}}">
                      <input type="radio" value="{{_id}}" {{isCurrentTeamId _id}} />
                      {{name}}
                    </a>
                  </li>
                {{/each}}
              </ul>
            </li>
            <li class="divider"><li>
          {{/if}}
          {{#if isOwner}}
            <li><a id="editTeam">Manage {{name}}</a></li>
          {{/if}}
          {{#if currentUser.rights.admin}}
            <li><a id="admin_link" href="/admin">Administration</a></li>

          {{/if}}
        </ul>
      </li>
    </ul>
  {{/with}}
</template>

<template name="teamManagement">
  {{#with current}}
    <div class="">
      <div class="">
        <h3><a href="#" id="teamName" class="editable" data-type="text" data-pk="{{_id}}">{{name}} <i class="icon-pencil"></i></a></h3>
      </div>    
      <div class="">
        <div class="span6">
          <h4>Current Members:</h4>
          <ul>
            {{#each teamMembers}}
              <li>{{profile.name}} - {{services.google.email}}</li>
            {{/each}}
          </ul>
        </div>
        <div class="span6">
          <h4>Open Invitations:</h4>
            <ul>
              {{#each invites}}
                <li>{{this}}</li>
              {{/each}}
          </ul>
        </div>
        <div class="span12">
          <h4>Invite someone</h4>
          <form id="addMember">
            <input type="text" id="newMember"  class="input-xlarge"/>
          </form>
        </div>
      </div>
    </div>
  {{/with}}
</template>

<template name="main">
  {{#with activity}}
    {{{ShowActivity this}}}
  {{/with}}
</template>

<template name="votableColumn">
  <ul class="unstyled">
    {{#each items }}
      <li class="activityItemRow">
        {{#if isVoting}}
          <span class="ai-vote">{{#if votes}} +{{votes.length}} {{/if}}
            {{#if myHasVotesRemaining}}
              <a class="vote-activity" data-pk="{{_id}}"><i class="{{voteIcon true}}" data-pk="{{_id}}"></i></a>
            {{else}}
              <a class="vote-activity" data-pk="{{_id}}"><i class="{{voteIcon false}}" data-pk="{{_id}}"></i></a>
            {{/if}}
          </span>
        {{/if}}
        {{#if owner}}
          <span>{{getUserName owner}}</span>
        {{/if}}
        <a class="activityItem editable" data-pk="{{_id}}" data-activity-type="1" data-type="text" data-inputclass="input-large">{{name}}</a>
        <span class="ai-actions" style="display:none">
          <a class="delete-activityItem pull-right"><i class="icon-trash" data-pk="{{_id}}"></i></a>
          {{#if ../spawnable}}
            {{#if isRetroLeader}}
              {{#if relatedActivity}}
                <a class="open-activity pull-right"><i class="icon-external-link" data-pk="{{relatedActivity}}"></i></a>
              {{else}}
                <a class="new-activity pull-right"><i class="icon-plus-sign-alt" data-pk="{{_id}}" data-name="{{name}}"></i></a>
              {{/if}}
            {{/if}}
          {{/if}}
          {{#if ../claimable}}
            <a class="ai-claim pull-right"><i class="icon-user" data-pk="{{_id}}"></i></a>
          {{/if}}
        </span>
      </li>
    {{/each}}
  </ul>
  <span class="editable-container editable-inline" id="newActivityInput" style="display:block">
    <form class="newActivityItemForm form-inline editableform">
      <input id="newActivityItemInput-{{type}}" type="text" class="input-block-level" data-activity-type="{{type}}">
    </form>
  </span>
</template>

<template name="votableColumns">
  <div class="row-fluid">
    {{#if definition.hasVotableColumn}}
      {{#if isRetroLeader}}
        <span class="pull-right">
          <label class="checkbox">
            Voting on?<input type="checkbox" id="votingToggle" {{#if voting.enabled}}checked{{/if}} />
          </label>
          <label class="checkbox">
            Show vote totals?<input type="checkbox" id="showVotesToggle" {{#if voting.showVotes}}checked{{/if}} />
          </label>
          <label class="checkbox">
            Sort by votes?<input type="checkbox" id="sortToggle" {{#if voting.sortByVotes}}checked{{/if}} />
          </label>
          <label>Votes per person?</label>
          <input class="input-mini" type="text" id="votesEach" value="{{definition.votesEach}}" data-default="{{definition.votesEach}}" size="2"/>
        </span>
      {{/if}}
    {{/if}}
    <h3>{{definition.title}}</h3>
    {{#if voting.enabled}}
      <dl class="dl-horizontal">
        <dt>My Votes Remaining</dt>
        <dd>{{myVotesRemaining}}</dd>
        <dt>Team Votes Remaining</dt>
        <dd>{{teamVotesRemaining}}</dd>
      </dt>
    {{/if}}
  </div>
  <div class="row-fluid">
    {{#each definition.columns}}
      <div class="{{../definition.columnClass}} well well-large">
        <h4>{{title}}</h4>
        {{> votableColumn }}
      </div>
    {{/each}}
  </div>
</template>

